#!/bin/bash

verbose=$1
host=linux
if [ `uname` = "Darwin" ] || [ `uname | egrep -i darwin` ]; then
    host=macosx
fi

function exec() 
{
    echo $1
    eval $1 $verbose
    if [ $? -ne 0 ]
        then exit
    fi
    echo ""
}

function build() 
{
    exec "xmake -r -P $1"

    if [ $host = "macosx" ]; then

        exec "xmake f -p iphoneos -P $1" 
        exec "xmake -r -P $1"

        exec "xmake f -p iphonesimulator -P $1"
        exec "xmake -r -P $1"
    fi
}

build "./tests/console_c" 
build "./tests/static_library_c" 
build "./tests/shared_library_c" 

build "./tests/console_c++"
build "./tests/static_library_c++" 
build "./tests/shared_library_c++" 

if [ $host = "macosx" ]; then

    build "./tests/console_objc" 
    build "./tests/console_objc++" 
    build "./tests/console_swift" 
fi
